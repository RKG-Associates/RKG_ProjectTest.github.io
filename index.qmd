---
title: "RKG_ProjectTest.github.io"
---

This is a sample site with some examples.

```{r,include=FALSE}
library(tidycensus)
library(tidyverse)
library(ggiraph)
library(patchwork)
library(scales)
library(dygraphs)
library(xts)

key <- Sys.getenv("CENSUS_API_KEY")
if (key == "") stop("CENSUS_API_KEY not found in environment")
census_api_key(key, install = FALSE, overwrite = TRUE)
```

Very cool chart for temporal data
```{r,include=FALSE}

census_api_key("24c7a36f2a50d9d5da28c754c56ca83a9cd09130") # this is the RKG census API key


latest_acs5_year <- {
  candidates <- 2026:2009
  ok <- map_lgl(candidates, ~{
    tryCatch({
      load_variables(.x, "acs5", cache = TRUE)
      TRUE
    }, error = function(e) FALSE)
  })
  max(candidates[ok])
}


years <- 2009:latest_acs5_year

maine_income_ts <- map_dfr(years, function(yr) {
  get_acs(
    geography = "state",
    state = "ME",
    variables = c(hhincome = "B19013_001"),
    year = yr,
    survey = "acs5"
  ) %>%
    transmute(
      year = yr,
      NAME,
      'Median HH Income' = estimate,
      moe
    )
})

maine_xts <- maine_income_ts %>%
  arrange(year) %>%
  mutate(date = as.Date(paste0(year, "-01-01"))) %>%
  select(date, 'Median HH Income') %>%
  xts(order.by = .$date)

dygraph(maine_xts, main = "Maine Median Household Income (ACS 5-year)") %>%
  dyLegend(show = "onmouseover") %>%
  dyAxis(
    "y",
    axisLabelFormatter = "function(y){ return '$' + y.toLocaleString(); }",
    valueFormatter     = "function(y){ return '$' + y.toLocaleString(); }"
  ) %>%
  dyAxis(
    "x",
    axisLabelFormatter = "function(d){ return new Date(d).getFullYear(); }"
  ) %>%
  dyRangeSelector()

```


```{r,include=FALSE}

maine_income <- get_acs(
  state = "Maine",
  geography = "county",
  variables = c(hhincome = "B19013_001"),
  year = 2020
) %>%
  mutate(NAME = str_remove(NAME, " County, Maine"))

```

Maine has a variety of income levels across counties. Counties in Southern Maine tend to have higher incomes.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(maine_income, aes(x = estimate, y = reorder(NAME, estimate))) + 
  geom_errorbarh(aes(xmin = estimate - moe, xmax = estimate + moe)) + 
  geom_point(size = 3, color = "darkgreen") + 
  theme_minimal(base_size = 12.5) + 
  labs(title = "Median household income", 
       subtitle = "Counties in Maine", 
       x = "2016-2020 ACS estimate", 
       y = "") + 
  scale_x_continuous(labels = label_dollar())


```

```{r, include = FALSE, echo=FALSE, message=FALSE, warning=FALSE}

vt_income <- get_acs(
  geography = "county",
  variables = "B19013_001",
  state = "VT",
  year = 2020,
  geometry = TRUE
) %>%
  mutate(NAME = str_remove(NAME, " County, Vermont"))

vt_map <- ggplot(vt_income, aes(fill = estimate)) + 
  geom_sf_interactive(aes(data_id = GEOID)) + 
  scale_fill_distiller(palette = "Greens",
                       direction = 1, 
                       guide = "none") + 
  theme_void()

vt_plot <- ggplot(vt_income, aes(x = estimate, y = reorder(NAME, estimate), 
                                 fill = estimate)) +
  geom_errorbar(aes(xmin = estimate - moe, xmax = estimate + moe)) +
  geom_point_interactive(color = "black", size = 4, shape = 21,
                         aes(data_id = GEOID)) +
  scale_fill_distiller(palette = "Greens", direction = 1,
                       labels = label_dollar()) + 
  scale_x_continuous(labels = label_dollar()) + 
  labs(title = "Household income by county in Vermont",
       subtitle = "2016-2020 American Community Survey",
       y = "",
       x = "ACS estimate (bars represent margin of error)",
       fill = "ACS estimate") + 
  theme_minimal(base_size = 14)

```

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

girafe(ggobj = vt_map + vt_plot, width_svg = 10, height_svg = 5) %>%
  girafe_options(opts_hover(css = "fill:cyan;"))
```

Findings

-   Interesting

-   Insight

-   Key Stat
